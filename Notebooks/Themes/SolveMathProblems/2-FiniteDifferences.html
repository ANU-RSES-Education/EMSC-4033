
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finite difference operations &#8212; EMSC 4033 Computational Geoscience</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Advanced finite difference" href="3-AdvancedFiniteDifferences.html" />
    <link rel="prev" title="Partial Differential Equations of Groundwater Flow" href="1-GroundwaterFlow-LectureNotes.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      <img src="../../../_static/AuWorldEQ.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EMSC 4033 Computational Geoscience</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../FrontPage.html">
   Computational Geosciences
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../IntroductoryRemarks.html">
   Modern approaches to programming
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  What is Python like ?
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../FirstSteps/Introduction2Python/0-CharacteristicsOfPython.html">
   What kind of Language is Python ?
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Version control
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../FirstSteps/Introduction2VersionControl/1-GettingStartedWithGit.html">
   An introduction to Version Control
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python, Step by Step
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../StepByStep/Introduction.html">
   Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Going deeper - examples from the Earth Sciences
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../0-StartHere.html">
   Index
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../NumpyAndScipy/0-NumpyAndScipy.html">
   Numpy and Scipy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/1-IntroductionToNumpy.html">
     Numpy data structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/2-Application-TheGameOfLife.html">
     The game of life
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/3-Discussion-TheGameOfLife.html">
     The game of life (Advanced)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/4-IntroductionToScipy.html">
     scipy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/5-ScipyInterpolate.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.interpolate
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/6-ScipySpatialAndMeshing.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.spatial
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/7-ScipyOptimize.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.optimize
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumpyAndScipy/8-Numpy%2BScipyMiscellany.html">
     Data storage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Mapping/0-Maps_with_Cartopy.html">
   Maps with the Cartopy Package
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/0-Preliminaries.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/1-IntroductingCartopy.html">
     Cartopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/2-ImagesAndGeoTIFFs.html">
     Handling images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/3-WorkingWithRealData.html">
     Australian magnetic intensity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/4-ContouringGlobalData.html">
     How to use contours to view global data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/5-WorkingWithPointData.html">
     Point Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/6-WorkingWithShuttleRadarTopography.html">
     Cartopy and the Shuttle Radar Topography Map data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/7-WorkingWithOn-DemandMappingServices.html">
     On demand mapping services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/8-GlobalPlateMotionsEtc.html">
     Global Plate Motions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/9-HimalayaRegionMapsAndImages.html">
     Himalaya Maps (1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Mapping/9a-HimalayaRegionMapsAndImages-Pt2.html">
     Himalaya Maps (2)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../SphericalMeshing/0-Stripy.html">
   Triangulations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/0-Spherical.html">
     Spherical Meshes
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex1-Spherical-Triangulations.html">
       Example 1 - Triangulation of arbitrary points on the sphere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex2-SphericalGrids.html">
       Example 2 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       predefined meshes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex3-Interpolation.html">
       Example 3 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       interpolation on the sphere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex4-Gradients.html">
       Example 4 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       gradients on the sphere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex5-Smoothing.html">
       Example 5 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       smoothing operations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex6-Scattered-Data.html">
       Example 6 - Scattered Data and ‘Heat Maps’
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex7-Refinement-of-Triangulations.html">
       Example 7 - Refining a triangulation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex8-Spline-Tension.html">
       Example 8 - Spline Tension
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/SphericalTriangulations/Ex9-Voronoi-Diagram.html">
       Example 9 - Constructing the Voronoi diagram
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/0-Cartesian.html">
     Cartesian Meshes
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex1-Cartesian-Triangulations.html">
       Example 1 - Triangulation of arbitrary points
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex2-CartesianGrids.html">
       Example 2 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       predefined meshes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex3-Interpolation.html">
       Example 3 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       interpolation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex4-Gradients.html">
       Example 4 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       gradients
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex5-Smoothing.html">
       Example 5 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       smoothing operations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex6-Scattered-Data.html">
       Example 6 - Scattered Data and ‘Heat Maps’
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex7-Refinement-of-Triangulations.html">
       Example 7 - Refining a triangulation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex8-Spline-Tension.html">
       Example 8 - Spline Tension
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/CartesianTriangulations/Ex9-Voronoi-Diagram.html">
       Example 9 - Constructing the Voronoi diagram
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../SphericalMeshing/Litho1pt0/Ex1-Litho1Layers.html">
     Introduction to the stripy wrapper for litho 1.0
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/Litho1pt0/Ex2-Litho1Properties.html">
       Litho 1.0 global sampling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/Litho1pt0/Ex3-CrustalRegionalisation.html">
       Crust 1.0 data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WorkEx1-CratonAverageProperties.html">
       Properties of the cratons
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WorkEx2-OceanDepthAge.html">
       Age of the oceans / depth of the oceans
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WEx2-Tutorial/Notebook-1.html">
       A quick look at the depth-age relationship for the seafloor.
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WEx2-Tutorial/Notebook-2.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WEx2-Tutorial/Notebook-3.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WEx2-Tutorial/Notebook-4.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../SphericalMeshing/Litho1pt0/WEx2-Tutorial/Notebook-5.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../SympleSympy/StartingWithSympy.html">
   Getting started with
   <code class="docutils literal notranslate">
    <span class="pre">
     sympy
    </span>
   </code>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../SympleSympy/StartingWithSympy-2.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       sympy
      </span>
     </code>
     for ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../SympleSympy/StartingWithSympy-3.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       sympy
      </span>
     </code>
     for a PDE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../SympleSympy/StartingWithSympy-4.html">
     The biharmonic equation for Stokes flow
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="0-IntroductionToNumericalSolutions.html">
   Numerical models
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="1-GroundwaterFlow-LectureNotes.html">
     Partial Differential Equations of Groundwater Flow
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Finite difference operations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3-AdvancedFiniteDifferences.html">
     Advanced finite difference
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../../_sources/Notebooks/Themes/SolveMathProblems/2-FiniteDifferences.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/Notebooks/Themes/SolveMathProblems/2-FiniteDifferences.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ANU-RSES-Education/EMSC-4033"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ANU-RSES-Education/EMSC-4033/master?urlpath=tree/Notebooks/Themes/SolveMathProblems/2-FiniteDifferences.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://emsc4033-2021.rses.underworldcloud.org/hub/user-redirect/git-pull?repo=https://github.com/ANU-RSES-Education/EMSC-4033&urlpath=tree/EMSC-4033/Notebooks/Themes/SolveMathProblems/2-FiniteDifferences.md&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finite-difference-approximations">
   1. Finite difference approximations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finite-difference-approximations-to-the-heat-equation-implicit-scheme">
   2. Finite difference approximations to the heat equation (implicit scheme)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solving-a-system-of-linear-equations">
     2.1 Solving a system of linear equations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#boundary-conditions">
   3. Boundary conditions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#periodic-boundary-conditions">
     3.1 Periodic boundary conditions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explicit-finite-difference-approximation">
   4. Explicit finite difference approximation
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="finite-difference-operations">
<h1>Finite difference operations<a class="headerlink" href="#finite-difference-operations" title="Permalink to this headline">¶</a></h1>
<p>At the end of this notebook, you will have learned how to…</p>
<ol class="simple">
<li><p>Use finite difference approximations to differentiate equations.</p></li>
<li><p>Apply this to the 2D steady-state heat equation and solve a linear system of equations.</p></li>
<li><p>Create periodic boundary conditions to simulate lateral variations in surface temperature.</p></li>
<li><p>(if we have time…) code your own finite difference approximation to the heat equation for variable diffusivity.</p></li>
<li><p>Solve temperature over complex geometries imported from GoCAD.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the appropriate python modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finite-difference-approximations">
<h2>1. Finite difference approximations<a class="headerlink" href="#finite-difference-approximations" title="Permalink to this headline">¶</a></h2>
<p>Ideally, an analytical solution would be obtained by integrating this equation with a set of boundary conditions.
Unfortunately finding a solution is not a trivial task and may only satisfy a very specific topic you are interested in solving.
The finite difference method approximates solutions to differential equations across a discreet domain with a set of boundary conditions along the edges of this domain.</p>
<a class="reference internal image-reference" href="../../../_images/fd.png"><img alt="../../../_images/fd.png" src="../../../_images/fd.png" style="width: 600px;" /></a>
<p>As you can gather from the above image, resolution is important.
If <span class="math notranslate nohighlight">\(h\)</span> is too large the solution is not very accurate, and with time time-dependence it could become <em>unstable</em>.</p>
<p>Lets take a simple function, \(f(x) = \sin (x)\). We can calculate its derivatives analytically:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
f'(x) &amp;= \cos (x) \\
f''(x) &amp;= -\sin (x)
\end{align}\end{split}\]</div>
<p>or we could use finite differences to approximate the derivatives…</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
f'(x) &amp;= \lim_{h\to0} \frac{f(x+h) - f(x)}{h} \\
f''(x)&amp;= \lim_{h\to0} \frac{f(x+2h) - 2f(x+h) + f(x)}{h^2}
\end{align}\end{split}\]</div>
<hr class="docutils" />
<blockquote>
<div><p><strong>EXERCISE 1</strong> Play around with the code below to see what happens when you change <span class="math notranslate nohighlight">\(f(x)\)</span> and vary <span class="math notranslate nohighlight">\(h\)</span>.</p>
</div></blockquote>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Resolution&quot;</span>
<span class="c1">#  Try a few different values  </span>

<span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">150</span>

<span class="c1"># Data</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">number_of_points</span><span class="p">)</span>
<span class="n">xh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># 1000 is more than enough to plot</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
<span class="n">dfh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xh</span><span class="p">)</span>
<span class="n">d2fh</span> <span class="o">=</span> <span class="o">-</span><span class="n">fh</span>

<span class="c1"># Normalization</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># use np.diff(x) if x is not uniform</span>

<span class="c1"># First derivatives</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span> <span class="c1"># numpy version</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>

<span class="c1"># Second derivatives</span>
<span class="n">ddf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># numpy version</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ddf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Plotting</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f &#39; (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">ddf</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f &#39;&#39; (x)&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xh</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xh</span><span class="p">,</span> <span class="n">dfh</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f &#39; (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xh</span><span class="p">,</span> <span class="n">d2fh</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f &#39;&#39; (x)&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The useful part of this is that we can differentiate an equation without knowing any calculus!
(Not that we recommend that!)</p>
<p>Finite difference is just one of many techniques that fall under the umbrella of <em>numerical modelling</em>.
Finite difference works by taking the average of neighbouring nodes within the domain to calculate the value on a specific node, \(N_{i,j}\).
In 2D these neighbouring nodes would be \(N_{i-1,j}, N_{i,j+1}, N_{i+1,j}, N_{i,j-1} \).</p>
<a class="reference internal image-reference" href="../../../_images/fd_ij.png"><img alt="../../../_images/fd_ij.png" src="../../../_images/fd_ij.png" style="width: 500px;" /></a>
</div>
<div class="section" id="finite-difference-approximations-to-the-heat-equation-implicit-scheme">
<h2>2. Finite difference approximations to the heat equation (implicit scheme)<a class="headerlink" href="#finite-difference-approximations-to-the-heat-equation-implicit-scheme" title="Permalink to this headline">¶</a></h2>
<p>The 2D heat equation is given as:</p>
<div class="math notranslate nohighlight">
\[\rho c_p \frac{\partial T}{\partial t} = \kappa \left( \frac{\partial^2 T}{\partial x^2} + \frac{\partial^2 T}{\partial y^2} \right) + H\]</div>
<p>where \(\rho\) is density, \(c_p\) is specific heat capacity, \(\kappa\) is the thermal diffusivity coefficient, and \(H\) are heat sources.</p>
<p>There are a few different ways to average - forward, backward, and central.
For the heat equation we are going to use the 2nd order central difference, which applied to the heat equation is:</p>
<div class="math notranslate nohighlight">
\[\kappa \left( \frac{T_{i,j-1}-2T_{i,j}+T_{i,j+1}}{\Delta x^2} + \frac{T_{i-1,j}-2T_{i,j}+T_{i+1,j}}{\Delta y^2} \right) = -H\]</div>
<p>Note that we have made \(\rho c_p \frac{\partial T}{\partial t} = 0\) because initially we are only going to solve this in steady-state.
Expanding the brackets and collecting like terms ( \(T_{i,j-1}, T_{i-1,j}, T_{i,j}, T_{i+1,j}, T_{i,j+1}\) ) we get,</p>
<div class="math notranslate nohighlight">
\[\left[\kappa\frac{T_{i,j-1}}{\Delta y^2}\right] + \left[\kappa\frac{T_{i-1,j}}{\Delta x^2}\right] - \left[\kappa\frac{2T_{i,j}}{\Delta x^2} - \kappa\frac{2T_{i,j}}{\Delta y^2}\right] + \left[\kappa\frac{T_{i+1,j}}{\Delta x^2}\right] + \left[\kappa\frac{T_{i,j+1}}{\Delta y^2}\right] = -H_{i,j}\]</div>
<p>\(H\) can be constant or spatially variable, \(H_{i,j}\), it doesn’t matter.</p>
<div class="section" id="solving-a-system-of-linear-equations">
<h3>2.1 Solving a system of linear equations<a class="headerlink" href="#solving-a-system-of-linear-equations" title="Permalink to this headline">¶</a></h3>
<p>You may have noticed that finite differences are linear approximations of a derivative.
Linear systems of equations are, it just so happens, very easy to solve using a computer!
The way to go about this is to build a matrices in the form,</p>
<div class="math notranslate nohighlight">
\[\mathbf{A x = b}\]</div>
<ul class="simple">
<li><p>\( \mathbf{A} \) is a square matrix, of shape <code class="docutils literal notranslate"><span class="pre">[n,n]</span></code>, that contains the finite difference operations.</p></li>
<li><p>\( \mathbf{b} \) contains our heat source terms, \(H \), and has a shape <code class="docutils literal notranslate"><span class="pre">[1,n]</span></code>.</p></li>
<li><p>\( \mathbf{x} \) is the temperature matrix, of shape <code class="docutils literal notranslate"><span class="pre">[1,n]</span></code>, for which we wish to solve.</p></li>
</ul>
<p>Here is a rectangular grid of nodes that we want to compute some finite difference operators on…</p>
<a class="reference internal image-reference" href="../../../_images/fd_nodes.png"><img alt="../../../_images/fd_nodes.png" src="../../../_images/fd_nodes.png" style="width: 500px;" /></a>
<p>Using the finite difference approximation for constant diffusivity, <span class="math notranslate nohighlight">\(\kappa\)</span>, the matrices will look like:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{A} = 
\begin{bmatrix}
\frac{\kappa}{\Delta y^2} &amp; \cdots &amp; \frac{\kappa}{\Delta x^2} &amp; (\frac{-2\kappa}{\Delta x^2}+\frac{-2\kappa}{\Delta y^2}) &amp; \frac{\kappa}{\Delta x^2} &amp; \cdots &amp; \frac{\kappa}{\Delta y^2} &amp; 0 &amp; 0 &amp; \cdots \\
0 &amp; \frac{\kappa}{\Delta y^2} &amp; \cdots &amp; \frac{\kappa}{\Delta x^2} &amp; (\frac{-2\kappa}{\Delta x^2}+\frac{-2\kappa}{\Delta y^2}) &amp; \frac{\kappa}{\Delta x^2} &amp; \cdots &amp; \frac{\kappa}{\Delta y^2} &amp; 0 &amp; \cdots \\
\vdots &amp;  &amp; \ddots &amp;  &amp; \ddots &amp; \ddots &amp;  &amp; \ddots &amp; &amp; \vdots \\
\cdots &amp; 0 &amp; 0 &amp; \frac{\kappa}{\Delta y^2} &amp; \cdots &amp; \frac{\kappa}{\Delta x^2} &amp; (\frac{-2\kappa}{\Delta x^2}+\frac{-2\kappa}{\Delta y^2}) &amp; \frac{\kappa}{\Delta x^2} &amp; \cdots &amp; \frac{\kappa}{\Delta y^2}
\end{bmatrix}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{x} =
\begin{bmatrix}
T_{9} \\ T_{10} \\ \vdots \\ T_{n}
\end{bmatrix}
\quad \mathbf{b} = 
\begin{bmatrix}
-H_{9} \\ -H_{10} \\ \vdots \\ -H_{n}
\end{bmatrix}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">25</span> <span class="c1"># No more than nx=100, ny=100</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span>

<span class="c1"># Create matrix structures</span>
<span class="n">A_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">))</span> <span class="c1"># square matrix</span>
<span class="n">b_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>

<span class="c1"># field variables</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">2e-6</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="c1"># boundary conditions (constant temperature)</span>
<span class="n">topBC</span> <span class="o">=</span> <span class="mf">300.0</span>
<span class="n">bottomBC</span> <span class="o">=</span> <span class="mf">800.0</span>
<span class="n">leftBC</span> <span class="o">=</span> <span class="mf">500.0</span>
<span class="n">rightBC</span> <span class="o">=</span> <span class="mf">500.0</span>

<span class="c1"># boundary nodes</span>
<span class="n">top_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="n">bottom_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
<span class="n">left_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">right_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">top_nodes</span><span class="p">:</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">b_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">topBC</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">bottom_nodes</span><span class="p">:</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">b_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">bottomBC</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">left_nodes</span><span class="p">:</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">b_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">leftBC</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">right_nodes</span><span class="p">:</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">b_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">rightBC</span>

<span class="n">bmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">bmask</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># these are nodes that do not intersect the boundary</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">bmask</span><span class="p">]:</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="o">-</span><span class="n">nx</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">k</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">k</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">A_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="n">nx</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="n">b_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">H</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">A_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A_matrix</span><span class="p">,</span> <span class="n">b_matrix</span><span class="p">)</span> <span class="c1"># solve x matrix</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Temperature (Kelvin)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span> <span class="c1"># Lets plot some contours</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Above we used numpy’s linear algebra solver and plot the temperature field.</p>
<hr class="docutils" />
<blockquote>
<div><p><strong>EXERCISE 2</strong> Change the boundary conditions, heat production, and conductivity above then plot the result below.</p>
</div></blockquote>
<hr class="docutils" />
<p>Matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is a banded diagonal matrix, which means that there are a lot of zeros.
Since the data only takes up a fraction of the whole matrix, we could use <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/sparse.html">scipy’s sparse module</a> to conserve memory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>from scipy import sparse
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">coo_matrix</span></code> is a common sparse matrix format that accepts a vector of row indices, column indices, and a vector of the same size for the values.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>coo_matrix((data, (row, col))
</pre></div>
</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathrm{row} =
\begin{bmatrix}
r_{0} \\ r_{0} \\ r_{1} \\ \vdots \\ r_{n}
\end{bmatrix}
\quad \mathrm{col} = 
\begin{bmatrix}
c_{0} \\ c_{1} \\ c_{0} \\ \vdots \\ c_{n}
\end{bmatrix}
\quad \mathrm{val} = 
\begin{bmatrix}
v_{0,0} \\ v_{0,1} \\ v_{1,0} \\ \vdots \\ v_{n,n}
\end{bmatrix}
\end{split}\]</div>
<p>Now we can achieve much higher resolutions using a fraction of the memory.</p>
</div>
</div>
<div class="section" id="boundary-conditions">
<h2>3. Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>In the previous exercise we used constant temperature boundary conditions on each wall in the model domain.
These are Dirichelet boundary conditions:</p>
<div class="math notranslate nohighlight">
\[T(n) = T_{\text{boundary}}\]</div>
<p>The other boundary condition we want to use is Neumann, or flux, boundary conditions:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial T}{\partial y}(n) = -\mathbf{q} = -\kappa \frac{\partial T}{\partial y}\]</div>
<p>in the \(y\) direction for example, where \(\mathbf{q}\) is the flux vector assigned to a wall of the domain.
For insulated boundary conditions, \(\mathbf{q}=0 \).
This means that no heat enters or escapes from that boundary.
For example, the finite difference form for this on the left wall of our domain would be:</p>
<div class="math notranslate nohighlight">
\[ \kappa \frac{T_{i,j}-T_{i+1,j}}{\Delta x^2} = \frac{\mathbf{q}}{\Delta x} - H\]</div>
<p>which reduces to</p>
<div class="math notranslate nohighlight">
\[ \kappa \frac{T_{i,j}-T_{i+1,j}}{\Delta x^2} = - H\]</div>
<p>when \( \mathbf{q}=0 \)</p>
<div class="section" id="periodic-boundary-conditions">
<h3>3.1 Periodic boundary conditions<a class="headerlink" href="#periodic-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<p>In the next exercise you will need to assign Neumann boundary conditions to all walls of the domain; except the top wall where you will assign a periodic Dirichlet boundary condition described by the equation:</p>
<div class="math notranslate nohighlight">
\[T_\text{surface} = T_0 + \Delta T \cos \frac{2\pi x}{\lambda}\]</div>
<p>Such surface temperature variations can arise as a result of topographic undulations and the altitude dependence of temperature in the Earth’s atmosphere.
Horizontal surface temperature variations also occur at the boundaries between land and bodies of water, such as lakes or seas.</p>
<hr class="docutils" />
<blockquote>
<div><p><strong>EXERCISE 3</strong> Create a periodic surface temperature boundary condition using the code above, then make the rest of the walls insulated.</p>
</div></blockquote>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Empty space for your code</span>
<span class="c1"># Copy the code you made above as a template</span>
</pre></div>
</div>
</div>
</div>
<p>Lucky there is an analytical solution to test if your code is working correctly…</p>
<div class="math notranslate nohighlight">
\[T(x,y) = T_0 + \Delta T \cos \frac{2 \pi x}{\lambda} e^{-2\pi y/\lambda}\]</div>
<p>Set your Neumann boundary conditions to zero and use this to <em>benchmark</em> your code.
Plot the results using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T_analytical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span> <span class="c1"># write analytical solution</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Analytical solution</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">T_analytical</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

<span class="c1"># Numerical solution</span>
<span class="c1">## YOUR CODE GOES HERE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="explicit-finite-difference-approximation">
<h2>4. Explicit finite difference approximation<a class="headerlink" href="#explicit-finite-difference-approximation" title="Permalink to this headline">¶</a></h2>
<p>So far we have an implicit approximation to the heat equation (great!) but what about an explicit approximation? Each have their own advantages.</p>
<ul class="simple">
<li><p>Implicit approximations are numerically stable and can calculate a steady state solution in one solve.</p></li>
<li><p>Explicit approximations iterate to a steady-state solution and are only stable if the timestep size is suitably small.</p>
<ul>
<li><p>But it is easy to implement time-dependent solutions.</p></li>
</ul>
</li>
</ul>
<p>The time-dependent heat equation can be approximated using a first-order forward finite difference in time, and second-order central finite difference scheme in space:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    \frac{\partial T}{\partial t} &amp;= \kappa \frac{\partial^2 T}{\partial x^2} \\
    \frac{T^{n+1}_i - T^n_i}{\Delta t} &amp;= \kappa \frac{T^n_{i+1} - 2T^n_i + T^n_{i-1}}{\Delta x^2}
\end{align}
\end{split}\]</div>
<p>The temperature solution is updated iteratively by rearranging the above equation:</p>
<div class="math notranslate nohighlight">
\[
T^{n+1}_i = T^n_i + \kappa \Delta t \frac{T^n_{i+1} - 2T^n_i + T^n_{i-1}}{\Delta x^2}
\]</div>
<p>We start with an initial condition of zero everywhere except for two Dirichlet boundary conditions at the top and bottom of the domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="c1"># Initial conditions</span>
<span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mf">300.</span>
<span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="mf">800.</span>

<span class="n">k</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># 1 timestep</span>
<span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">gradTx</span><span class="p">,</span> <span class="n">gradTy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
<span class="n">flux_x</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">gradTx</span>
<span class="n">flux_y</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">gradTy</span>

<span class="n">gradTxx</span><span class="p">,</span> <span class="n">gradTxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">flux_x</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
<span class="n">gradTyx</span><span class="p">,</span> <span class="n">gradTyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">flux_y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

<span class="n">divT</span> <span class="o">=</span> <span class="n">gradTxx</span> <span class="o">+</span> <span class="n">gradTyy</span>
<span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">k</span>
<span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>

<span class="n">T_new</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">divT</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">T_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<blockquote>
<div><p><strong>EXERCISE 4</strong> Create a loop to iterately update the temperature until we reach convergence. Use the solution from the implicit scheme to compare the results.</p>
</div></blockquote>
<hr class="docutils" />
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Notebooks/Themes/SolveMathProblems"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="1-GroundwaterFlow-LectureNotes.html" title="previous page">Partial Differential Equations of Groundwater Flow</a>
    <a class='right-next' id="next-link" href="3-AdvancedFiniteDifferences.html" title="next page">Advanced finite difference</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Louis Moresi<br/>
        
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>