
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Example 4 - stripy gradients &#8212; EMSC 4033 Computational Geoscience</title>
    
  <link href="../../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Example 5 - stripy smoothing operations" href="Ex5-Smoothing.html" />
    <link rel="prev" title="Example 3 - stripy interpolation" href="Ex3-Interpolation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      <img src="../../../../_static/AuWorldEQ.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EMSC 4033 Computational Geoscience</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../FrontPage.html">
   Computational Geosciences
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../IntroductoryRemarks.html">
   Modern approaches to programming
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  What is Python like ?
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../FirstSteps/Introduction2Python/0-CharacteristicsOfPython.html">
   What kind of Language is Python ?
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Version control
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../FirstSteps/Introduction2VersionControl/1-GettingStartedWithGit.html">
   An introduction to Version Control
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python, Step by Step
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../StepByStep/Introduction.html">
   Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Going deeper - examples from the Earth Sciences
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../0-StartHere.html">
   Index
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../NumpyAndScipy/0-NumpyAndScipy.html">
   Numpy and Scipy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/1-IntroductionToNumpy.html">
     Numpy data structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/2-Application-TheGameOfLife.html">
     The game of life
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/3-Discussion-TheGameOfLife.html">
     The game of life (Advanced)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/4-IntroductionToScipy.html">
     scipy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/5-ScipyInterpolate.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.interpolate
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/6-ScipySpatialAndMeshing.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.spatial
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/7-ScipyOptimize.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.optimize
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../NumpyAndScipy/8-Numpy%2BScipyMiscellany.html">
     Data storage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../Mapping/0-Maps_with_Cartopy.html">
   Maps with the Cartopy Package
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/0-Preliminaries.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/1-IntroductingCartopy.html">
     Cartopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/2-ImagesAndGeoTIFFs.html">
     Handling images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/3-WorkingWithRealData.html">
     Australian magnetic intensity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/4-ContouringGlobalData.html">
     How to use contours to view global data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/5-WorkingWithPointData.html">
     Point Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/6-WorkingWithShuttleRadarTopography.html">
     Cartopy and the Shuttle Radar Topography Map data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/7-WorkingWithOn-DemandMappingServices.html">
     On demand mapping services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/8-GlobalPlateMotionsEtc.html">
     Global Plate Motions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/9-HimalayaRegionMapsAndImages.html">
     Himalaya Maps (1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Mapping/9a-HimalayaRegionMapsAndImages-Pt2.html">
     Himalaya Maps (2)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../0-Stripy.html">
   Triangulations
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../SphericalTriangulations/0-Spherical.html">
     Spherical Meshes
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex1-Spherical-Triangulations.html">
       Example 1 - Triangulation of arbitrary points on the sphere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex2-SphericalGrids.html">
       Example 2 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       predefined meshes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex3-Interpolation.html">
       Example 3 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       interpolation on the sphere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex4-Gradients.html">
       Example 4 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       gradients on the sphere
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex5-Smoothing.html">
       Example 5 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       smoothing operations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex6-Scattered-Data.html">
       Example 6 - Scattered Data and ‘Heat Maps’
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex7-Refinement-of-Triangulations.html">
       Example 7 - Refining a triangulation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex8-Spline-Tension.html">
       Example 8 - Spline Tension
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../SphericalTriangulations/Ex9-Voronoi-Diagram.html">
       Example 9 - Constructing the Voronoi diagram
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="0-Cartesian.html">
     Cartesian Meshes
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Ex1-Cartesian-Triangulations.html">
       Example 1 - Triangulation of arbitrary points
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex2-CartesianGrids.html">
       Example 2 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       predefined meshes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex3-Interpolation.html">
       Example 3 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       interpolation
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Example 4 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       gradients
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex5-Smoothing.html">
       Example 5 -
       <code class="docutils literal notranslate">
        <span class="pre">
         stripy
        </span>
       </code>
       smoothing operations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex6-Scattered-Data.html">
       Example 6 - Scattered Data and ‘Heat Maps’
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex7-Refinement-of-Triangulations.html">
       Example 7 - Refining a triangulation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex8-Spline-Tension.html">
       Example 8 - Spline Tension
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Ex9-Voronoi-Diagram.html">
       Example 9 - Constructing the Voronoi diagram
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Litho1pt0/Ex1-Litho1Layers.html">
     Introduction to the stripy wrapper for litho 1.0
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Litho1pt0/Ex2-Litho1Properties.html">
       Litho 1.0 global sampling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Litho1pt0/Ex3-CrustalRegionalisation.html">
       Crust 1.0 data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Litho1pt0/WorkEx1-CratonAverageProperties.html">
       Properties of the cratons
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Litho1pt0/WorkEx2-OceanDepthAge.html">
       Age of the oceans / depth of the oceans
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../Litho1pt0/WEx2-Tutorial/Notebook-1.html">
       A quick look at the depth-age relationship for the seafloor.
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../Litho1pt0/WEx2-Tutorial/Notebook-2.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../Litho1pt0/WEx2-Tutorial/Notebook-3.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../Litho1pt0/WEx2-Tutorial/Notebook-4.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../Litho1pt0/WEx2-Tutorial/Notebook-5.html">
         A quick look at the depth-age relationship for the seafloor.
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../SympleSympy/StartingWithSympy.html">
   Getting started with
   <code class="docutils literal notranslate">
    <span class="pre">
     sympy
    </span>
   </code>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../SympleSympy/StartingWithSympy-2.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       sympy
      </span>
     </code>
     for ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../SympleSympy/StartingWithSympy-3.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       sympy
      </span>
     </code>
     for a PDE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../SympleSympy/StartingWithSympy-4.html">
     The biharmonic equation for Stokes flow
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../SolveMathProblems/0-IntroductionToNumericalSolutions.html">
   Numerical models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../SolveMathProblems/1-GroundwaterFlow-LectureNotes.html">
     Partial Differential Equations of Groundwater Flow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../SolveMathProblems/2-FiniteDifferences.html">
     Finite difference operations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../SolveMathProblems/3-AdvancedFiniteDifferences.html">
     Advanced finite difference
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../Bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../../../_sources/Notebooks/Themes/SphericalMeshing/CartesianTriangulations/Ex4-Gradients.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../_sources/Notebooks/Themes/SphericalMeshing/CartesianTriangulations/Ex4-Gradients.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ANU-RSES-Education/EMSC-4033"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ANU-RSES-Education/EMSC-4033/master?urlpath=tree/Notebooks/Themes/SphericalMeshing/CartesianTriangulations/Ex4-Gradients.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://emsc4033-2021.rses.underworldcloud.org/hub/user-redirect/git-pull?repo=https://github.com/ANU-RSES-Education/EMSC-4033&urlpath=tree/EMSC-4033/Notebooks/Themes/SphericalMeshing/CartesianTriangulations/Ex4-Gradients.md&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notebook-contents">
   Notebook contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-a-computational-mesh">
   Define a computational mesh
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analytic-function">
   Analytic function
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivatives-of-solution-compared-to-analytic-values">
   Derivatives of solution compared to analytic values
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="example-4-stripy-gradients">
<h1>Example 4 - <code class="docutils literal notranslate"><span class="pre">stripy</span></code> gradients<a class="headerlink" href="#example-4-stripy-gradients" title="Permalink to this headline">¶</a></h1>
<p>SRFPACK is a Fortran 77 software package that constructs a smooth interpolatory or approximating surface to data values associated with arbitrarily distributed points. It employs automatically selected tension factors to preserve shape properties of the data and avoid overshoot and undershoot associated with steep gradients.</p>
<div class="section" id="notebook-contents">
<h2>Notebook contents<a class="headerlink" href="#notebook-contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#Analytic-function">Analytic function and derivatives</a></p></li>
<li><p><a class="reference external" href="#Derivatives-of-solution-compared-to-analytic-values">Evaluating accuracy</a></p></li>
</ul>
<p>The next example is <a class="reference internal" href="Ex5-Smoothing.html"><span class="doc std std-doc">Ex5-Smoothing</span></a></p>
</div>
<div class="section" id="define-a-computational-mesh">
<h2>Define a computational mesh<a class="headerlink" href="#define-a-computational-mesh" title="Permalink to this headline">¶</a></h2>
<p>Use the (usual) icosahedron with face points included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stripy</span> <span class="k">as</span> <span class="nn">stripy</span>

<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span>

<span class="n">spacingX</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">spacingY</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">stripy</span><span class="o">.</span><span class="n">cartesian_meshes</span><span class="o">.</span><span class="n">elliptical_mesh</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">spacingX</span><span class="p">,</span> <span class="n">spacingY</span><span class="p">,</span> <span class="n">refinement_levels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">stripy</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">permute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of points = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="analytic-function">
<h2>Analytic function<a class="headerlink" href="#analytic-function" title="Permalink to this headline">¶</a></h2>
<p>Define a relatively smooth function that we can interpolate from the coarse mesh to the fine mesh and analyse</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">analytic</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k1</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k2</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">analytic_ddx</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
     <span class="k">return</span> <span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k1</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k2</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">analytic_ddy</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k1</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k2</span><span class="o">*</span><span class="n">ys</span><span class="p">)</span> 

<span class="n">analytic_sol</span> <span class="o">=</span> <span class="n">analytic</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">analytic_sol_ddx</span> <span class="o">=</span> <span class="n">analytic_ddx</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">analytic_sol_ddy</span> <span class="o">=</span> <span class="n">analytic_ddy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">y</span>
    
    <span class="n">trip</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">simplices</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">trip</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">return</span>

    
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="s2">&quot;analytic solution&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="derivatives-of-solution-compared-to-analytic-values">
<h2>Derivatives of solution compared to analytic values<a class="headerlink" href="#derivatives-of-solution-compared-to-analytic-values" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">gradient</span></code> method of <code class="docutils literal notranslate"><span class="pre">Triangulation</span></code> takes a data array f representing values on the mesh vertices and returns the x,y derivatives.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Triangulation</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

</pre></div>
</div>
<p>Derivatives of higher accuracy can be obtained by tweaking <code class="docutils literal notranslate"><span class="pre">tol</span></code>, which controls the convergence tolerance, or <code class="docutils literal notranslate"><span class="pre">nit</span></code> which controls the number of iterations to a solution. The default values are set to an optimal trade-off between speed and accuracy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stripy_ddx</span><span class="p">,</span> <span class="n">stripy_ddy</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">analytic_sol</span><span class="p">)</span>
<span class="n">stripy_d2x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">stripy_ddx</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">stripy_d2y</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">stripy_ddy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">stripy_ddx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddy&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">stripy_ddy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddx&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">stripy_d2x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;d2x&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">stripy_d2y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;d2y&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stripy</span> <span class="kn">import</span> <span class="n">_srfpack</span>
<span class="k">def</span> <span class="nf">second_gradient_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the gradient / 2nd partials of an n-dimensional array.</span>

<span class="sd">    The method consists of minimizing a quadratic functional Q(G) over</span>
<span class="sd">    gradient vectors (in x and y directions), where Q is an approximation</span>
<span class="sd">    to the linearized curvature over the triangulation of a C-1 bivariate</span>
<span class="sd">    function \\(F(x,y)\\) which interpolates the nodal values and gradients.</span>

<span class="sd">    Args:</span>
<span class="sd">        f : array of floats, shape (n,)</span>
<span class="sd">            field over which to evaluate the gradient</span>
<span class="sd">        nit : int (default: 3)</span>
<span class="sd">            number of iterations to reach a convergence tolerance,</span>
<span class="sd">            tol nit &gt;= 1</span>
<span class="sd">        tol: float (default: 1e-3)</span>
<span class="sd">            maximum change in gradient between iterations.</span>
<span class="sd">            convergence is reached when this condition is met.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dfdx : array of floats, shape (n,)</span>
<span class="sd">            derivative of f in the x direction</span>
<span class="sd">        dfdy : array of floats, shape (n,)</span>
<span class="sd">            derivative of f in the y direction</span>

<span class="sd">    Notes:</span>
<span class="sd">        For SIGMA = 0, optimal efficiency was achieved in testing with</span>
<span class="sd">        tol = 0, and nit = 3 or 4.</span>

<span class="sd">        The restriction of F to an arc of the triangulation is taken to be</span>
<span class="sd">        the Hermite interpolatory tension spline defined by the data values</span>
<span class="sd">        and tangential gradient components at the endpoints of the arc, and</span>
<span class="sd">        Q is the sum over the triangulation arcs, excluding interior</span>
<span class="sd">        constraint arcs, of the linearized curvatures of F along the arcs --</span>
<span class="sd">        the integrals over the arcs of \\( (d^2 F / dT^2)^2\\), where \\( d^2 F / dT^2\\)is the second</span>
<span class="sd">        derivative of \\(F\\) with respect to distance \\(T\\) along the arc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;f should be the same size as mesh&#39;</span><span class="p">)</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
    <span class="n">iflgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflgs</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shuffle_field</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shuffle_simplices</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="c1">## wrapping: </span>

    <span class="c1"># subroutine gradc(k,ncc,lcc,n,x,y,z,list,lptr,lend,dx,dy,dxx,dxy,dyy,ier) ! in :_srfpack:srfpack.f</span>
    <span class="c1"># subroutine gradg(  ncc,lcc,n,x,y,z,list,lptr,lend,iflgs,sigma,nit,dgmax,grad,ier) ! in :_srfpack:srfpack.f</span>

    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">dxy</span><span class="p">,</span> <span class="n">dyy</span><span class="p">,</span> <span class="n">ierr</span> <span class="o">=</span> <span class="n">_srfpack</span><span class="o">.</span><span class="n">gradcs</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lptr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lend</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ierr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ierr=</span><span class="si">{}</span><span class="s1"> in gradc</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ierr</span><span class="p">,</span> <span class="n">_ier_codes</span><span class="p">[</span><span class="n">ierr</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">dxy</span><span class="p">,</span> <span class="n">dyy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gradient_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the gradient at a specified node.</span>

<span class="sd">    This routine employs a local method, in which values depend only on nearby</span>
<span class="sd">    data points, to compute an estimated gradient at a node.</span>

<span class="sd">    `gradient_local()` is more efficient than `gradient()` only if it is unnecessary</span>
<span class="sd">    to compute gradients at all of the nodes. Both routines have similar accuracy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;f should be the same size as mesh&#39;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shuffle_field</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shuffle_simplices</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="n">gradX</span><span class="p">,</span> <span class="n">gradY</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">_srfpack</span><span class="o">.</span><span class="n">gradls</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span>\
                                     <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lptr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lend</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gradX</span><span class="p">,</span> <span class="n">gradY</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">npoints</span><span class="p">)</span>

<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">gradient_local</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stripy_ddy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dx</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddx&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddy&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">stripy_ddx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;d2x&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">stripy_ddy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;d2y&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">npoints</span><span class="p">)</span>
<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">dxy</span><span class="p">,</span> <span class="n">dyy</span> <span class="o">=</span> <span class="n">second_gradient_local</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d2x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stripy_d2x</span><span class="p">)</span>
<span class="n">d2y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stripy_d2y</span><span class="p">)</span>
<span class="n">d1x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stripy_d2y</span><span class="p">)</span>
<span class="n">d1y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stripy_d2y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">npoints</span><span class="p">):</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">dxy</span><span class="p">,</span> <span class="n">dyy</span> <span class="o">=</span> <span class="n">second_gradient_local</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">d2x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dxx</span>
    <span class="n">d2y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyy</span>
    <span class="n">d1x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx</span>
    <span class="n">d1y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">d1x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddy&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">d1y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddx&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">d2x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;d2x&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">d2y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;d2y&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The next example is <a class="reference internal" href="Ex5-Smoothing.html"><span class="doc std std-doc">Ex5-Smoothing</span></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dsdx</span><span class="p">,</span> <span class="n">dsdy</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">analytic_sol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dsdx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dsdy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">dsdx</span><span class="p">,</span> <span class="n">dsdy</span><span class="p">),</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">smoothing</span><span class="p">(</span><span class="n">analytic_sol</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">analytic_sol</span><span class="p">),</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dsdx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dsdy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">analytic_sol</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dsdx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddy&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dsdy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddx&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dsdx</span><span class="o">-</span><span class="n">analytic_sol_ddx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddx_err&quot;</span><span class="p">)</span>
<span class="n">axis_mesh_field</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">dsdy</span><span class="o">-</span><span class="n">analytic_sol_ddy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ddy_err&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The next notebook is <a class="reference internal" href="Ex5-Smoothing.html"><span class="doc std std-doc">Ex5-Smoothing</span></a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Notebooks/Themes/SphericalMeshing/CartesianTriangulations"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Ex3-Interpolation.html" title="previous page">Example 3 - <code class="docutils literal notranslate"><span class="pre">stripy</span></code> interpolation</a>
    <a class='right-next' id="next-link" href="Ex5-Smoothing.html" title="next page">Example 5 - <code class="docutils literal notranslate"><span class="pre">stripy</span></code> smoothing operations</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Louis Moresi<br/>
        
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>